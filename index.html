<script>
    // On change le nom ici : 'supabaseClient' au lieu de 'supabase'
    const _url = "https://ykrxslzmvhilmhkdicqj.supabase.co";
    const _key = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlrcnhzbHptdmhpbG1oa2RpY3FqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY4NjAxNTAsImV4cCI6MjA4MjQzNjE1MH0.l0piAICXO6Sjqufjxlbo8nIYqVHEL5lxbzyHJRygEXI"; // <--- Mets ta clé ANON ici
    const supabaseClient = supabase.createClient(_url, _key); 

    async function loadData() {
        // On utilise le nouveau nom 'supabaseClient'
        const { data, error } = await supabaseClient.from('emissions').select('*');
        
        if (error) {
            console.error("Erreur de récupération:", error);
            document.getElementById('loading').innerText = "Erreur de chargement des données.";
            return;
        }

        if (data) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('emissions-table').style.display = 'table';
            let total = 0;
            const body = document.getElementById('table-body');
            body.innerHTML = ""; // On vide avant de remplir
            
            data.forEach(row => {
                total += row.tco2_total;
                body.innerHTML += `<tr>
                    <td>${row.date_reporting}</td>
                    <td>${row.entite}</td>
                    <td>${row.categorie_scope}</td>
                    <td>${row.type_activite}</td>
                    <td>${row.tco2_total.toFixed(2)}</td>
                </tr>`;
            });
            document.getElementById('total-val').innerText = `Bilan Total : ${total.toFixed(2)} tCO2e`;
        }
    }
    loadData();
</script>
